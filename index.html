<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AroundTheWorld</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåç</text></svg>">
  <style>
    :root{ --bg:#0b1020; --panel:#ffffff; --muted:#64748b; --accent:#1f850b; --team1:#3b82f6; --team2:#ef4444; --team3:#10b981 }
    html,body{ height:100%; margin:0; font-family:Inter, Roboto, Arial, sans-serif; background:var(--bg); color:#0f1724 }
    .app{ display:flex; height:100vh; gap:16px; padding:16px; box-sizing:border-box }
    #globe{ flex:1; min-height:320px; border-radius:12px; overflow:hidden; position:relative; background:#081124 }
    #infoPanel{ width:360px; max-width:40%; background:linear-gradient(180deg,#fff,#f8fafc); border-radius:12px; padding:20px; box-shadow:0 6px 24px rgba(2,6,23,.4); display:flex; flex-direction:column; gap:12px }
    #infoPanel h2{ margin:0 0 6px 0; font-size:18px }
    .meta{ color:var(--muted); font-size:13px }
    #countryInfo h3{ margin:0 0 6px 0 }
    #countryInfo p{ margin:4px 0 }
    .game-panel{ background:#f1f5f9; border-radius:8px; padding:12px; margin-top:12px }
    .game-panel h4{ color:var(--accent); margin:0 0 8px 0 }
    .team{ display:flex; align-items:center; gap:8px; margin-bottom:8px }
    .team-color{ width:16px; height:16px; border-radius:50% }
    .team1{ background:var(--team1) }
    .team2{ background:var(--team2) }
    .team3{ background:var(--team3) }
    .game-btn{ background:var(--accent); color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; margin-top:8px }
    .controls{ display:flex; gap:8px; margin-top:auto }
    button{ background:var(--accent); color:white; border:none; padding:8px 10px; border-radius:8px; cursor:pointer }
    button.secondary{ background:#e6eef0; color:#08363a }
    #tooltip{ position:absolute; pointer-events:none; transform:translate(-50%,-120%); background:rgba(3,7,18,0.9); color:#fff; padding:6px 8px; border-radius:6px; font-size:13px; white-space:nowrap; display:none; z-index:10 }
    .loader{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(0,0,0,0.25), transparent); z-index:8 }
    .spinner{ width:44px; height:44px; border-radius:50%; border:4px solid rgba(255,255,255,0.08); border-top-color:var(--accent); animation:spin 1s linear infinite }
    .teams-panel{ position:fixed; top:16px; left:16px; background:white; padding:12px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.15); z-index:20 }
    .quiz-modal{ position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:20px; border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,0.2); z-index:30; display:none; max-width:500px; width:80% }
    .quiz-options{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:15px 0 }
    .quiz-option{ padding:10px; border:2px solid #e2e8f0; border-radius:8px; cursor:pointer; text-align:center }
    .quiz-option:hover{ background:#f1f5f9 }
    .close-btn{ position:absolute; top:10px; right:10px; background:none; border:none; font-size:20px; cursor:pointer }
    .timer{ font-size:24px; color:var(--accent); margin-bottom:10px }
    .leaderboard{ margin-top:20px; padding:10px; background:#f1f5f9; border-radius:8px }
    .leaderboard h4{ margin:0 0 8px 0 }
    .leaderboard ul{ list-style:none; padding:0; margin:0 }
    .leaderboard li{ display:flex; justify-content:space-between; margin-bottom:5px }
    @keyframes spin{ to{ transform:rotate(360deg) } }
    @media (max-width:900px){ .app{ flex-direction:column } #infoPanel{ width:100%; max-width:none } .teams-panel{ top:auto; bottom:16px; left:16px; right:16px } }
  </style>
</head>
<body>
  <div class="app">
    <div id="globe" aria-label="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥–ª–æ–±—É—Å" role="region">
      <div id="tooltip" role="status" aria-hidden="true"></div>
      <div class="loader" id="loader"><div class="spinner" aria-hidden="true"></div></div>
    </div>

    <aside id="infoPanel" aria-live="polite">
      <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä–∞–Ω–µ</h2>
      <div class="meta">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –Ω–∞ –≥–ª–æ–±—É—Å–µ</div>
      <div id="countryInfo">
        <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å—Ç—Ä–∞–Ω–µ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–≥—Ä—ã.</p>
      </div>
      <div class="controls">
        <button id="resetBtn" class="secondary" aria-label="–°–±—Ä–æ—Å–∏—Ç—å –≤–∏–¥">–°–±—Ä–æ—Å–∏—Ç—å –≤–∏–¥</button>
        <button id="autoRotateBtn" aria-pressed="true">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–∞—â–µ–Ω–∏–µ</button>
      </div>
    </aside>
  </div>

  <div class="teams-panel" id="teamsPanel">
    <h3>–ö–æ–º–∞–Ω–¥–Ω–∞—è –∏–≥—Ä–∞</h3>
    <div class="team">
      <div class="team-color team1"></div>
      <span>–ö–æ–º–∞–Ω–¥–∞ 1: <span id="team1Score">0</span> –æ—á–∫–æ–≤</span>
    </div>
    <div class="team">
      <div class="team-color team2"></div>
      <span>–ö–æ–º–∞–Ω–¥–∞ 2: <span id="team2Score">0</span> –æ—á–∫–æ–≤</span>
    </div>
    <div class="team">
      <div class="team-color team3"></div>
      <span>–ö–æ–º–∞–Ω–¥–∞ 3: <span id="team3Score">0</span> –æ—á–∫–æ–≤</span>
    </div>
    <button id="assignTeamsBtn" class="game-btn">–ù–∞–∑–Ω–∞—á–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã</button>
  </div>

  <div class="quiz-modal" id="quizModal">
    <button class="close-btn" id="closeQuiz">√ó</button>
    <div class="timer" id="quizTimer"></div>
    <h3 id="quizQuestion"></h3>
    <div class="quiz-options" id="quizOptions"></div>
    <div id="quizResult"></div>
    <div class="leaderboard">
      <h4>–õ–∏–¥–µ—Ä–±–æ—Ä–¥</h4>
      <ul id="leaderboardList"></ul>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/globe.gl@2.29.0/dist/globe.gl.min.js"></script>

  <script>
    window.addEventListener('load', function() {
      const countries = [
        { 
          name: "–ö–∏—Ç–∞–π", capital: "–ü–µ–∫–∏–Ω", population: "1,4 –º–ª—Ä–¥", area: "9,6 –º–ª–Ω –∫–º¬≤", 
          lat: 35.8617, lng: 104.1954, size: 1.6,
          games: [
            {
              type: "quiz",
              title: "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –æ –ö–∏—Ç–∞–µ",
              questions: [
                {
                  question: "–ö–∞–∫–∞—è —Å—Ç–µ–Ω–∞ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º–æ–π –¥–ª–∏–Ω–Ω–æ–π –≤ –º–∏—Ä–µ?",
                  options: ["–í–µ–ª–∏–∫–∞—è –ö–∏—Ç–∞–π—Å–∫–∞—è —Å—Ç–µ–Ω–∞", "–°—Ç–µ–Ω–∞ –¢—Ä–æ–∏", "–ë–µ—Ä–ª–∏–Ω—Å–∫–∞—è —Å—Ç–µ–Ω–∞", "–°—Ç–µ–Ω–∞ –ü–ª–∞—á–∞"],
                  answer: 0,
                  points: 10
                },
                {
                  question: "–ö–∞–∫–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ —è–≤–ª—è–µ—Ç—Å—è —Å–∏–º–≤–æ–ª–æ–º –ö–∏—Ç–∞—è?",
                  options: ["–¢–∏–≥—Ä", "–ü–∞–Ω–¥–∞", "–î—Ä–∞–∫–æ–Ω", "–û–±–µ–∑—å—è–Ω–∞"],
                  answer: 1,
                  points: 8
                }
              ]
            }
          ]
        },
        { 
          name: "–°–®–ê", capital: "–í–∞—à–∏–Ω–≥—Ç–æ–Ω", population: "331 –º–ª–Ω", area: "9,8 –º–ª–Ω –∫–º¬≤", 
          lat: 37.0902, lng: -95.7129, size: 1.4,
          games: [
            {
              type: "quiz",
              title: "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –æ –°–®–ê",
              questions: [
                {
                  question: "–°–∫–æ–ª—å–∫–æ —à—Ç–∞—Ç–æ–≤ –≤ –°–®–ê?",
                  options: ["48", "50", "52", "45"],
                  answer: 1,
                  points: 5
                },
                {
                  question: "–ö—Ç–æ –±—ã–ª –ø–µ—Ä–≤—ã–º –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–æ–º –°–®–ê?",
                  options: ["–¢–æ–º–∞—Å –î–∂–µ—Ñ—Ñ–µ—Ä—Å–æ–Ω", "–ê–≤—Ä–∞–∞–º –õ–∏–Ω–∫–æ–ª—å–Ω", "–î–∂–æ—Ä–¥–∂ –í–∞—à–∏–Ω–≥—Ç–æ–Ω", "–ë–∞—Ä–∞–∫ –û–±–∞–º–∞"],
                  answer: 2,
                  points: 10
                }
              ]
            }
          ]
        },
        { 
          name: "–ò–Ω–¥–∏—è", capital: "–ù—å—é-–î–µ–ª–∏", population: "1,38 –º–ª—Ä–¥", area: "3,3 –º–ª–Ω –∫–º¬≤", 
          lat: 20.5937, lng: 78.9629, size: 1.6,
          games: [
            {
              type: "quiz", 
              title: "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –æ–± –ò–Ω–¥–∏–∏",
              questions: [
                {
                  question: "–ö–∞–∫–∞—è —Ä–µ–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–≤—è—â–µ–Ω–Ω–æ–π –≤ –ò–Ω–¥–∏–∏?",
                  options: ["–ì–∞–Ω–≥", "–ù–∏–ª", "–ê–º–∞–∑–æ–Ω–∫–∞", "–ú–∏—Å—Å–∏—Å–∏–ø–∏"],
                  answer: 0,
                  points: 10
                }
              ]
            }
          ]
        },
        { 
          name: "–ë—Ä–∞–∑–∏–ª–∏—è", capital: "–ë—Ä–∞–∑–∏–ª–∏–∞", population: "213 –º–ª–Ω", area: "8,5 –º–ª–Ω –∫–º¬≤", 
          lat: -14.2350, lng: -51.9253, size: 1.2,
          games: [
            {
              type: "quiz",
              title: "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –æ –ë—Ä–∞–∑–∏–ª–∏–∏", 
              questions: [
                {
                  question: "–ö–∞–∫–æ–π –∫–∞—Ä–Ω–∞–≤–∞–ª —Å–∞–º—ã–π –∏–∑–≤–µ—Å—Ç–Ω—ã–π –≤ –ë—Ä–∞–∑–∏–ª–∏–∏?",
                  options: ["–ö–∞—Ä–Ω–∞–≤–∞–ª –≤ –†–∏–æ", "–ö–∞—Ä–Ω–∞–≤–∞–ª –≤ –°–∞–Ω-–ü–∞—É–ª—É", "–ö–∞—Ä–Ω–∞–≤–∞–ª –≤ –°–∞–ª–≤–∞–¥–æ—Ä–µ", "–ö–∞—Ä–Ω–∞–≤–∞–ª –≤ –†–µ—Å–∏—Ñ–∏"],
                  answer: 0,
                  points: 8
                }
              ]
            }
          ]
        },
        { 
          name: "–†–æ—Å—Å–∏—è", capital: "–ú–æ—Å–∫–≤–∞", population: "146 –º–ª–Ω", area: "17,1 –º–ª–Ω –∫–º¬≤", 
          lat: 61.5240, lng: 105.3188, size: 1.8,
          games: [
            {
              type: "quiz",
              title: "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –æ –†–æ—Å—Å–∏–∏",
              questions: [
                {
                  question: "–ö–∞–∫–æ–µ –æ–∑–µ—Ä–æ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º—ã–º –≥–ª—É–±–æ–∫–∏–º –≤ –º–∏—Ä–µ?",
                  options: ["–ë–∞–π–∫–∞–ª", "–ö–∞—Å–ø–∏–π—Å–∫–æ–µ –º–æ—Ä–µ", "–õ–∞–¥–æ–∂—Å–∫–æ–µ –æ–∑–µ—Ä–æ", "–û–Ω–µ–∂—Å–∫–æ–µ –æ–∑–µ—Ä–æ"],
                  answer: 0,
                  points: 12
                },
                {
                  question: "–ö–∞–∫–æ–π –≥–æ—Ä–æ–¥ –±—ã–ª —Å—Ç–æ–ª–∏—Ü–µ–π –†–æ—Å—Å–∏–∏ –¥–æ –ú–æ—Å–∫–≤—ã?",
                  options: ["–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ö–∏–µ–≤", "–ù–æ–≤–≥–æ—Ä–æ–¥", "–í–ª–∞–¥–∏–º–∏—Ä"],
                  answer: 0,
                  points: 10
                }
              ]
            }
          ]
        }
      ];

      const gameState = {
        teams: [
          { id: 1, name: "–ö–æ–º–∞–Ω–¥–∞ 1", score: 0, color: "#3b82f6" },
          { id: 2, name: "–ö–æ–º–∞–Ω–¥–∞ 2", score: 0, color: "#ef4444" },
          { id: 3, name: "–ö–æ–º–∞–Ω–¥–∞ 3", score: 0, color: "#10b981" }
        ],
        currentTeam: null,
        completedGames: {}
      };

      const container = document.getElementById('globe');
      const tooltip = document.getElementById('tooltip');
      const loader = document.getElementById('loader');
      const countryInfoEl = document.getElementById('countryInfo');
      const quizModal = document.getElementById('quizModal');
      const quizQuestion = document.getElementById('quizQuestion');
      const quizOptions = document.getElementById('quizOptions');
      const quizResult = document.getElementById('quizResult');
      const quizTimer = document.getElementById('quizTimer');
      const leaderboardList = document.getElementById('leaderboardList');
      let currentCountry = null;
      let currentGame = null;
      let currentQuestionIndex = 0;
      let quizInterval = null;
      let quizTime = 10; // –í—Ä–µ–º—è –Ω–∞ –≤–æ–ø—Ä–æ—Å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

      const texturePaths = {
        globe: 'https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-blue-marble.jpg',
        bump: 'https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-topology.png',
        bg: 'https://cdn.jsdelivr.net/npm/three-globe/example/img/night-sky.png'
      };

      function initGlobe() {
        try {
          const world = Globe()
            .globeImageUrl(texturePaths.globe)
            .bumpImageUrl(texturePaths.bump)
            .backgroundImageUrl(texturePaths.bg)
            .showAtmosphere(true)
            .atmosphereColor('#3a228a')
            .pointsData(countries)
            .pointLat(d => d.lat)
            .pointLng(d => d.lng)
            .pointAltitude(d => 0.01 + d.size * 0.002)
            .pointColor(d => {
              const completed = gameState.completedGames[d.name] || [];
              return completed.length > 0 ? '#10b981' : '#ff6b6b';
            })
            .pointRadius(0.4)
            .pointsTransitionDuration(300)
            .pointLabel(d => `${d.name}\n–°—Ç–æ–ª–∏—Ü–∞: ${d.capital}`)
            (container);

          const renderer = world.renderer();
          const maxRatio = Math.min(window.devicePixelRatio || 1, 2);
          renderer.setPixelRatio(maxRatio);

          const controls = world.controls();
          if (controls) {
            controls.enablePan = false;
            controls.minDistance = 150;
            controls.maxDistance = 800;
            controls.rotateSpeed = 0.4;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.3;
          }

          const scene = world.scene();
          const ambient = new THREE.AmbientLight(0xffffff, 0.6);
          const dir = new THREE.DirectionalLight(0xffffff, 0.8);
          dir.position.set(5, 3, 5);
          scene.add(ambient, dir);

          setTimeout(() => {
            loader.style.display = 'none';
          }, 1500);

          world.onPointHover(point => {
            if (point) {
              tooltip.style.display = 'block';
              tooltip.textContent = `${point.name} ‚Äî ${point.capital}`;
              tooltip.setAttribute('aria-hidden', 'false');
              container.style.cursor = 'pointer';
            } else {
              tooltip.style.display = 'none';
              tooltip.setAttribute('aria-hidden', 'true');
              container.style.cursor = 'default';
            }
          });

          world.onPointClick(country => {
            if (!country) return;
            currentCountry = country;
            world.pointOfView({ lat: country.lat, lng: country.lng, altitude: 1.4 }, 1000);
            renderCountryInfo(country);
            if (controls) { controls.autoRotate = false; }
            document.getElementById('autoRotateBtn').textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä–∞—â–µ–Ω–∏–µ';
            document.getElementById('autoRotateBtn').setAttribute('aria-pressed', 'false');
          });

          document.getElementById('resetBtn').addEventListener('click', () => {
            world.pointOfView({ lat: 20, lng: 0, altitude: 2.2 }, 1200);
            countryInfoEl.innerHTML = '<p>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –Ω–∞ –≥–ª–æ–±—É—Å–µ.</p>';
            if (controls) { controls.autoRotate = true; }
            document.getElementById('autoRotateBtn').textContent = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–∞—â–µ–Ω–∏–µ';
            document.getElementById('autoRotateBtn').setAttribute('aria-pressed', 'true');
          });

          document.getElementById('autoRotateBtn').addEventListener('click', e => {
            const pressed = e.currentTarget.getAttribute('aria-pressed') === 'true';
            const next = !pressed;
            if (controls) controls.autoRotate = next;
            e.currentTarget.textContent = next ? '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–∞—â–µ–Ω–∏–µ' : '–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä–∞—â–µ–Ω–∏–µ';
            e.currentTarget.setAttribute('aria-pressed', String(next));
          });

          container.addEventListener('mousemove', e => {
            const rect = container.getBoundingClientRect();
            tooltip.style.left = `${e.clientX - rect.left}px`;
            tooltip.style.top = `${e.clientY - rect.top}px`;
          });

          world.pointOfView({ lat: 20, lng: 0, altitude: 2.2 }, 0);

        } catch (error) {
          console.error('Error initializing globe:', error);
          loader.innerHTML = `<p style="color: white;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</p>`;
        }
      }

      function renderCountryInfo(country) {
        const completedGames = gameState.completedGames[country.name] || [];
        
        let gamesHTML = '';
        country.games.forEach((game, index) => {
          const isCompleted = completedGames.includes(index);
          gamesHTML += `
            <div class="game-panel">
              <h4>${game.title} ${isCompleted ? '‚úì' : ''}</h4>
              <p>–¢–∏–ø: ${game.type === 'quiz' ? '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞' : '–ò–≥—Ä–∞'}</p>
              ${!isCompleted ? `
                <button class="game-btn" data-game="${index}">–ò–≥—Ä–∞—Ç—å</button>
              ` : `
                <p>–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</p>
              `}
            </div>
          `;
        });
        
        countryInfoEl.innerHTML = `
          <h3>${country.name}</h3>
          <p><strong>–°—Ç–æ–ª–∏—Ü–∞:</strong> ${country.capital}</p>
          <p><strong>–ù–∞—Å–µ–ª–µ–Ω–∏–µ:</strong> ${country.population}</p>
          <p><strong>–ü–ª–æ—â–∞–¥—å:</strong> ${country.area}</p>
          ${gamesHTML}
        `;
        
        document.querySelectorAll('.game-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            const gameIndex = parseInt(this.dataset.game);
            startGame(country, gameIndex);
          });
        });
      }

      function startGame(country, gameIndex) {
        const game = country.games[gameIndex];
        currentGame = game;
        currentQuestionIndex = 0;
        
        if (game.type === 'quiz') {
          showQuizQuestion();
        }
      }

      function showQuizQuestion() {
        if (!currentGame || currentQuestionIndex >= currentGame.questions.length) {
          endGame();
          return;
        }
        
        const question = currentGame.questions[currentQuestionIndex];
        quizQuestion.textContent = question.question;
        quizOptions.innerHTML = '';
        quizResult.textContent = '';
        
        question.options.forEach((option, index) => {
          const optionEl = document.createElement('div');
          optionEl.className = 'quiz-option';
          optionEl.textContent = option;
          optionEl.dataset.index = index;
          optionEl.addEventListener('click', () => checkAnswer(index));
          quizOptions.appendChild(optionEl);
        });
        
        quizModal.style.display = 'block';
        startQuizTimer();
      }

      function startQuizTimer() {
        quizTime = 10;
        quizInterval = setInterval(() => {
          quizTime--;
          quizTimer.textContent = `–í—Ä–µ–º—è: ${quizTime} —Å–µ–∫—É–Ω–¥`;
          if (quizTime <= 0) {
            clearInterval(quizInterval);
            quizResult.textContent = '–í—Ä–µ–º—è –≤—ã—à–ª–æ!';
            quizResult.style.color = 'red';
            setTimeout(() => {
              currentQuestionIndex++;
              showQuizQuestion();
            }, 2000);
          }
        }, 1000);
      }

      function checkAnswer(selectedIndex) {
        clearInterval(quizInterval);
        const question = currentGame.questions[currentQuestionIndex];
        const isCorrect = selectedIndex === question.answer;
        
        if (isCorrect) {
          quizResult.textContent = '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! +' + question.points + ' –æ—á–∫–æ–≤';
          quizResult.style.color = 'green';
          
          if (gameState.currentTeam) {
            gameState.teams[gameState.currentTeam - 1].score += question.points;
            updateScores();
          }
        } else {
          quizResult.textContent = '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ' + question.options[question.answer];
          quizResult.style.color = 'red';
        }
        
        setTimeout(() => {
          currentQuestionIndex++;
          showQuizQuestion();
        }, 2000);
      }

      function endGame() {
        quizModal.style.display = 'none';
        
        if (!gameState.completedGames[currentCountry.name]) {
          gameState.completedGames[currentCountry.name] = [];
        }
        gameState.completedGames[currentCountry.name].push(countries.findIndex(c => c.name === currentCountry.name));

        renderCountryInfo(currentCountry);

        const world = Globe.getInstance(container);
        if (world) {
          world.pointColor(d => {
            const completed = gameState.completedGames[d.name] || [];
            return completed.length > 0 ? '#10b981' : '#ff6b6b';
          });
        }
      }

      function updateScores() {
        document.getElementById('team1Score').textContent = gameState.teams[0].score;
        document.getElementById('team2Score').textContent = gameState.teams[1].score;
        document.getElementById('team3Score').textContent = gameState.teams[2].score;
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
        const sortedTeams = [...gameState.teams].sort((a, b) => b.score - a.score);
        leaderboardList.innerHTML = '';
        sortedTeams.forEach(team => {
          const li = document.createElement('li');
          li.textContent = `${team.name}: ${team.score} –æ—á–∫–æ–≤`;
          leaderboardList.appendChild(li);
        });
      }

      function assignTeams() {
        const teamNumber = prompt("–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É (1, 2 –∏–ª–∏ 3):");
        if (teamNumber && ['1', '2', '3'].includes(teamNumber)) {
          gameState.currentTeam = parseInt(teamNumber);
          alert(`–¢–µ–ø–µ—Ä—å –∏–≥—Ä–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞ ${gameState.currentTeam}`);
        }
      }

      document.getElementById('closeQuiz').addEventListener('click', () => {
        quizModal.style.display = 'none';
      });

      document.getElementById('assignTeamsBtn').addEventListener('click', assignTeams);

      initGlobe();
      updateScores();
    });
  </script>
</body>
</html>